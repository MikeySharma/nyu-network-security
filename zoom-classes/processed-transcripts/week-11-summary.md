## Comprehensive Summary of Network Security Class - Week 12

**Subject:** CS 6.823 Network Security

**Instructor:** Professor Philip Mack

**Date:** Monday, April 21st, 2025

**Learning Objectives:** This week's class aimed to solidify students' understanding of the Transport Layer Security (TLS) protocol, its vulnerabilities, and the importance of perfect forward secrecy.  The class also introduced Layer 2 security concepts, focusing on vulnerabilities and related attacks like CAM table overflow, VLAN hopping, and DHCP attacks. The instructor emphasized practical application through exercises and related these concepts to real-world scenarios and current industry practices.

**Teaching Approach:** Professor Mack employed a highly interactive approach, using real-world examples, diagrams, step-by-step explanations, and in-class exercises to illustrate key concepts. He encouraged student participation and addressed questions thoroughly, providing detailed explanations and clarifying common misconceptions.

**Topics Covered:**

* **TLS Handshake and Cipher Suites:** Deep dive into the 10-step TLS handshake, analyzing different cipher suites and their implications for security.
* **Perfect Forward Secrecy:** Understanding the concept and its importance in protecting past communications even if private keys are compromised in the future.
* **TLS Record Layer Format and Handshake Protocol:** Examining the structure of TLS packets and the various message types involved in the handshake process.
* **TLS 1.3 Improvements and Compatibility:** Discussing the advantages of TLS 1.3, including improved speed and security, and the challenges in its adoption due to legacy systems.
* **Layer 2 Security Vulnerabilities:** Introduction to the inherent security weaknesses in Layer 2 protocols and their potential impact on higher layers.
* **CAM Table Overflow Attack and Port Security:** Explanation of the attack mechanism and the countermeasure of port security, along with its practical limitations.
* **VLAN Hopping Attacks:** Discussion of switch spoofing and double encapsulation attacks, highlighting their impact and mitigation strategies.
* **DHCP Attacks:** Analysis of the DHCP protocol and its vulnerabilities to spoofing attacks, emphasizing the potential consequences of manipulated DHCP responses.


### Key Topics in Detail:

**1. TLS Handshake and Cipher Suites:**

* **10-Step TLS Handshake:** The class meticulously reviewed the 10-step TLS handshake process, analyzing the exchange of information at each step. Two cipher suites were analyzed:
    * **TLS_DHE_RSA_WITH_AES_128_CBC_SHA256:** This cipher suite uses Diffie-Hellman Ephemeral (DHE) for key exchange and RSA for authentication. The class highlighted that the RSA public key (N, E) is exchanged in step 3, while the private key (N, D) is never exchanged. DHE parameters (g, N, A, B) are partially exchanged (g, N, A's public value, B's public value) in steps 4 and 6, while the private values (a, b) are never exchanged.  The pre-master secret (key K) is derived from the DHE exchange and is never directly exchanged.
    * **TLS_RSA_WITH_AES_128_CBC_SHA256:** This cipher suite uses RSA for both key exchange and authentication.  The RSA public key is exchanged in step 3, while the private key is never exchanged.  The pre-master secret is generated by the client, encrypted with the server's public key, and sent in step 6. The server decrypts it using its private key.
* **Cipher Suite Analysis:** The instructor emphasized the importance of understanding the components of a cipher suite and how they affect security.

**2. Perfect Forward Secrecy (PFS):**

* **Concept:** PFS ensures that past communications remain confidential even if the server's private key is compromised in the future.  This is achieved by using ephemeral keys for each session, meaning that compromising a long-term key does not compromise past session keys.
* **Real-world Example:** The instructor used the example of shopping on Amazon. If Amazon's server is hacked tomorrow, PFS prevents the attacker from decrypting today's purchase information.
* **Comparison of Cipher Suites:** The class compared the two cipher suites discussed earlier in the context of PFS.  The DHE_RSA cipher suite provides PFS because the session key is derived from ephemeral DHE parameters.  The RSA cipher suite does not provide PFS because the pre-master secret is encrypted with the server's long-term RSA key.

**3. TLS Record Layer Format and Handshake Protocol:**

* **Record Layer Format:** The instructor explained the structure of TLS packets, including the content type (handshake, alert, application data, etc.), version, length, and encrypted data.
* **Handshake Protocol:** The various message types within the handshake protocol (ClientHello, ServerHello, Certificate, etc.) were reviewed, along with their respective roles in establishing a secure connection.

**4. TLS 1.3 Improvements and Compatibility:**

* **Improvements:** TLS 1.3 offers significant improvements over TLS 1.2, including reduced handshake latency (by about 750ms), stronger security defaults, and removal of insecure features.
* **3-Step Handshake:** The simplified 3-step handshake in TLS 1.3 was compared to the longer handshake in TLS 1.2.
* **Compatibility Issues and Extensions:**  The instructor explained how TLS 1.3 is often implemented as an extension to TLS 1.2 due to compatibility issues with older appliances. This involves the client advertising support for TLS 1.3 in an extension within the ClientHello message, even though the main version field indicates TLS 1.2.

**5. Layer 2 Security Vulnerabilities:**

* **Introduction:**  The instructor emphasized that Layer 2, being the foundation of the OSI model, lacks robust security mechanisms, making it vulnerable to various attacks.

**6. CAM Table Overflow Attack and Port Security:**

* **CAM Table:** The class reviewed the concept of a CAM table, which maps MAC addresses to physical ports on a switch.  It's crucial for efficient switching of Ethernet frames.
* **Attack Mechanism:** The attacker floods the switch with frames containing spoofed source MAC addresses, exhausting the CAM table's limited memory. This forces the switch to behave like a hub, broadcasting all traffic to all ports, allowing the attacker to eavesdrop.
* **Port Security:** This countermeasure limits the number of MAC addresses learned on a port.  If the limit is exceeded, the port can be shut down.
* **Limitations of Port Security:** The instructor discussed the practical limitations of port security, such as the administrative overhead of managing MAC address limits and the challenges posed by mobile devices and virtual machines.

**7. VLAN Hopping Attacks:**

* **VLAN Concept:** The class reviewed the concept of VLANs, which segment a physical network into multiple logical networks.
* **Switch Spoofing:** The attacker pretends to be a switch, establishing a trunk link and gaining access to all VLANs.  This attack is mitigated by disabling auto-trunking.
* **Double Encapsulation:** The attacker sends frames with double VLAN tags, exploiting a vulnerability in some switches that allows them to access a different VLAN than intended. This attack is mitigated by explicitly configuring allowed VLANs on trunk ports and avoiding the use of native VLANs.

**8. DHCP Attacks:**

* **DHCP Protocol:** The class reviewed the 4-step DHCP process: DHCPDISCOVER, DHCPOFFER, DHCPREQUEST, and DHCPACK.
* **Attack Mechanism:** The attacker responds to DHCPDISCOVER messages with a malicious DHCPOFFER, providing incorrect information such as rogue DNS servers, default gateway, or web proxy.  Since the client typically accepts the first offer, this allows the attacker to redirect traffic or perform man-in-the-middle attacks.
* **Vulnerability Analysis:** The instructor emphasized the lack of security in DHCP, making it susceptible to spoofing attacks.


### Exercises & Discussions:

* **Exercise 1A:** Analyzing TLS key exchange in a DHE_RSA cipher suite.
* **Exercise 1B:** Analyzing TLS key exchange in an RSA cipher suite.
* **Exercise 2:** Discussing the drawbacks and administrative challenges of implementing port security.
* **Exercise 3:** Identifying potential problems with manipulated DHCP responses (rogue DNS, default gateway, web proxy).

### Important Announcements:

* **Homework 1:** Due May 12th.
* **Lab 4 (IP Tables Firewalls):** Due April 27th (5% extra credit for submitting up to 5 days early).
* **Bonus Exercises (Firewall Lesson):** Due May 1st.
* **Catch-up Reminder:** Students were urged to catch up on any missed material as the final exam is approaching.

### Final Takeaways:

* TLS is a complex protocol with various cipher suites and configurations. Understanding these intricacies is crucial for ensuring secure communication.
* Perfect forward secrecy is essential for protecting past communications from future key compromises.
* Layer 2 security is often overlooked but is critical for overall network security.
* Practical limitations can hinder the implementation of security measures like port security.
* DHCP is vulnerable to spoofing attacks, and understanding these vulnerabilities is crucial for network administrators.

**Follow-up Actions:**

* Review the lecture slides and notes.
* Complete the assigned homework and lab exercises.
* Research and explore additional resources on TLS and Layer 2 security.

**Motivational Note:** Network security is a constantly evolving field. Staying informed about the latest threats and vulnerabilities is crucial for protecting yourself and your organization. By actively applying the concepts learned in this class, you can contribute to a more secure digital world.