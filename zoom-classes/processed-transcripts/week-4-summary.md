## Cs. 6,823 Network Security Class Summary

**Instructor:** Professor Philip Mack
**Date:** Tuesday, February 18, 2025
**Week:** 4
**Lesson:** 2, Part 2

### 1. Introduction

This class focused on practical aspects of network security, specifically diving deeper into network scanning techniques and attack methodologies using tools like Scapy, Wireshark, and Nmap. The learning objectives were to understand various TCP and UDP attack vectors, the functioning of traceroute programs, ARP cache poisoning, and the nuances of different Nmap scan types. Professor Mack employed a practical, example-driven teaching approach, incorporating real-world scenarios, live demonstrations, and interactive exercises to solidify student understanding. The topics covered included Lab 2 walkthrough, a review of reconnaissance tools, DNS zone transfers, service discovery, TCP and UDP scanning techniques, and different Nmap scan types.  These topics are crucial for understanding how attackers probe and exploit network vulnerabilities, and how defenders can mitigate these threats.

### 2. Key Topics

#### 2.1 Lab 2 Walkthrough

Lab 2 focused on TCP attacks and built upon the concepts introduced in Lab 1.  It consisted of four main tasks and an extra credit task.

* **Task 1: Packet Capturing and Filtering:**  Students were tasked with using Scapy's `sniff()` function to capture network packets and employing Berkeley Packet Filter (BPF) filters to refine captures.  This task emphasized the importance of filtering to avoid capturing unnecessary packets, especially those generated by Scapy itself.  Wireshark was recommended for testing BPF filters before implementing them in Scapy.

* **Task 2: Spoofing an ICMP Echo Request:** This task involved spoofing an ICMP echo request (ping) packet, making it appear as if it originated from a different source (e.g., Google's DNS server 8.8.8.8). The objective was to understand how attackers can manipulate source IP addresses to deceive target machines.

    * **Normal ICMP Echo:** User sends ICMP Echo Request to server; server replies with ICMP Echo Reply.
    * **Spoofed ICMP Echo:** Attacker sends ICMP Echo Request to user, with source IP spoofed as a different server; user replies to the spoofed server.

* **Task 3: Writing a Traceroute Program:** Students had to implement a traceroute program using Scapy, sending ICMP echo requests with incrementing Time-To-Live (TTL) values. The program needed to capture ICMP replies from each hop and handle cases where a hop doesn't respond. The provided skeleton code lacked proper handling of no-reply scenarios, requiring students to implement this functionality.

    * **Traceroute Process:** Send ICMP Echo Request with TTL=1; capture reply from first hop. Repeat with TTL=2, capturing reply from second hop, and so on until the destination is reached.

* **Task 4: Spoofing ICMP Echo Replies:** This task involved sniffing the network for ICMP echo requests and responding with spoofed ICMP echo replies.  Three scenarios were outlined:

    * **Scenario 1: Pinging a Non-Existent IP (1.2.3.4):**  User pings a non-existent IP; attacker's program intercepts the request and sends a spoofed reply. User receives one reply (from the attacker).
    * **Scenario 2: Pinging a Non-Existent Local IP (10.9.0.99):** User pings a non-existent local IP. The ping process performs an ARP request first, which fails.  The attacker's program never sees an ICMP echo request and thus doesn't respond. User receives no replies.
    * **Scenario 3: Pinging Google's DNS Server (8.8.8.8):** User pings Google's DNS server; attacker's program intercepts the request and sends a spoofed reply in addition to the legitimate reply from Google. User receives two replies.

* **Extra Credit (Task 5): ARP Cache Poisoning:**  To make the scenario 2 in Task 4 work (pinging 10.9.0.99), students needed to implement ARP cache poisoning. This involved crafting ARP replies to associate the non-existent IP address with the attacker's MAC address, effectively redirecting traffic intended for the non-existent host.

#### 2.2 Reconnaissance Tools Review

The instructor reviewed several reconnaissance tools discussed in previous lessons:

* **Maltego:** Open-source intelligence (OSINT) gathering tool for collecting information from various online sources.
* **Creepy:** Tool for harvesting location metadata from photos posted on social media.
* **EDGAR Database:** SEC database containing financial filings of publicly traded companies.
* **Shodan:** Search engine for internet-connected devices, including IoT devices and vulnerable servers.
* **Google Search Filtering:** Using advanced search operators (e.g., `site:`) for targeted information gathering.
* **Google Hacking/Exploit-DB:** Utilizing pre-made Google search queries (dorks) to identify vulnerabilities.
* **DNS Dumpster:** Tool for discovering subdomains associated with a given domain.

#### 2.3 DNS Zone Transfers

The class revisited DNS zone transfers, a vulnerability that allows attackers to retrieve all DNS records from a DNS server. While now disabled by default, it highlighted the importance of proper DNS configuration.  Split DNS was introduced as a mitigation strategy, employing separate internal and external DNS servers.

#### 2.4 Service Discovery and Port Scanning

The focus shifted to service discovery, the process of identifying open ports and running services on a target host. Port scanning was introduced as the primary method for achieving this.

* **TCP Port Scanning:**

    * **TCP Three-Way Handshake:**  The instructor reviewed the three steps:
        1. Client sends SYN packet.
        2. Server responds with SYN-ACK packet.
        3. Client sends ACK packet.

    * **Port Status Determination:**
        * **Open Port:** Server responds with SYN-ACK.
        * **Closed Port:** Server responds with RST (reset).
        * **Filtered Port (Firewall):**  Server sends ICMP Destination Unreachable (reject) or no response (drop).

* **Nmap Scan Types:**

    * **TCP SYN Scan:** Sends SYN packets; very fast.
    * **TCP Connect Scan:**  Completes the full three-way handshake and then closes the connection; slower than SYN scan. Requires operating system API calls.
    * **TCP FIN Scan:** Sends FIN packets; used for OS fingerprinting.
    * **TCP NULL Scan:** Sends packets with no flags set; used for OS fingerprinting.
    * **TCP Xmas Scan:** Sends packets with FIN, URG, and PUSH flags set; used for OS fingerprinting.
    * **TCP ACK Scan:** Sends ACK packets; used to probe firewall rules, especially for stateless firewalls.  Can reveal outgoing allowed ports.

* **UDP Port Scanning:**

    * **Open Port:** Server sends a response specific to the protocol (e.g., DNS response for port 53).
    * **Closed Port:** Server sends ICMP Destination Unreachable.
    * **Filtered Port (Firewall):** No response.


### 3. Exercises & Discussions

* **Exercise 1:** List three reconnaissance tools discussed in the last lesson. (Answers included Maltego, Creepy, EDGAR, Shodan, Google Hacking, DNS Dumpster).
* **Exercise 2:** Explain the three steps in the TCP three-way handshake. (SYN, SYN-ACK, ACK).
* **Exercise 3:** What are the four possible responses to a TCP SYN scan? (SYN-ACK, RST, ICMP Destination Unreachable, No Response).
* **Exercise 4:** In UDP scanning, what are three possible responses and their meanings? (Response specific to the protocol, ICMP Destination Unreachable, No Response).
* **Exercise A:** Explain the difference between a TCP SYN scan and a TCP Connect scan, providing scenarios where each would be useful. (SYN scan is faster, Connect scan is slower but can be used when Nmap lacks root privileges).

### 4. Important Announcements

* **Lab 1:** Due February 16th, with a late submission option until February 26th (1% deduction per day, up to 10%).
* **Lab 2:** Released and due March 2nd. 5% bonus for submitting 5 days early. 5% bonus for completing the extra credit task.
* **TA Office Hours:** Tuesday at 8 PM Eastern Time. Schedule available on Brightspace.
* **Midterm Exam:** Implied to be coming up, with port scanning being a key topic.


### 5. Final Takeaways

This class provided a deep dive into practical network scanning and attack techniques. Students gained hands-on experience with tools like Scapy and Nmap, focusing on TCP and UDP attacks, traceroute implementation, and ARP cache poisoning. Understanding these concepts is crucial for both offensive and defensive security professionals.  Students are encouraged to review the provided resources and lab materials, practice with the tools discussed, and prepare for the upcoming midterm exam.  By mastering these techniques, students can better understand the attack landscape and develop effective security strategies. Remember, the best defense is a good offense â€“ understanding how attackers operate is the first step to building robust security measures.